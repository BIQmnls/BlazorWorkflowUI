@page "/"

@inject WorkflowService WorkflowService
@inject NavigationManager Nav

<MudContainer MaxWidth="MaxWidth.False">
    <MudStack Spacing="2">
        <MudStack Direction="Row" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
            <MudText Typo="Typo.h4">Workflows</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@CreateWorkflow">New Workflow</MudButton>
        </MudStack>

        <MudTable Items="_workflows" Hover="true">
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Trigger</MudTh>
                <MudTh></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd>@context.Name</MudTd>
                <MudTd>@context.Trigger.Name</MudTd>
                <MudTd>
                    <MudButton Size="Size.Small" Variant="Variant.Text" OnClick="@(() => EditWorkflow(context.Id))">Edit</MudButton>
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudStack>
</MudContainer>

@code {
    private List<Workflow> _workflows = new();

    protected override async Task OnInitializedAsync()
    {
        _workflows = await WorkflowService.GetWorkflowsAsync();
    }

    void CreateWorkflow()
    {
        var id = Guid.NewGuid().ToString();
        Nav.NavigateTo($"/workflow/{id}");
    }

    void EditWorkflow(string id) => Nav.NavigateTo($"/workflow/{id}");
}

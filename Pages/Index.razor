@page "/"

@inject IWorkflowService WorkflowService

<MudContainer MaxWidth="MaxWidth.Medium" Class="mx-auto my-4">
    <MudPaper Class="p-6">
        <MudTextField T="string" @bind-Value="_workflow.Name" Label="Workflow Name" Placeholder="Enter a workflow name" Variant="Variant.Filled" Class="mb-4" />
        <MudDivider Class="my-4" />
        <SimpleWorkflowDiagram Workflow="_workflow" ActivityOptions="_activityOptions" ConditionOptions="_conditionOptions" TriggerOptions="_triggerOptions" />
        <MudDivider Class="my-4" />
        <MudStack Direction="Row" Spacing="1" Justify="flex-end">
            <MudButton OnClick="Save" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save">Save</MudButton>
            <MudButton OnClick="Load" Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Filled.FolderOpen">Load</MudButton>
        </MudStack>
    </MudPaper>
</MudContainer>

@code {
    protected WorkflowModel _workflow = new();

    protected string? _json;
    private readonly List<string> _triggerOptions = new() { "PolicyCreated", "PremiumDue", "MortgageApplicationSubmitted" };
    private readonly List<string> _activityOptions = new() { "SendPolicyDocument", "EvaluateMortgageApplication" };
    private readonly List<string> _conditionOptions = new() { "NoCondition", "PolicyActive", "LoanApproved" };

    void Generate()
    {
        _json = WorkflowService.GenerateJson(_workflow);
    }

    void Save()
    {
        WorkflowService.Save(_workflow);
    }

    void Load()
    {
        var loaded = WorkflowService.Load(_workflow.Name);
        if (loaded is not null)
        {
            _workflow = loaded;
        }
    }
}

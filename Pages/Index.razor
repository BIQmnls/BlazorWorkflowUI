@page "/"

@inject IWorkflowService WorkflowService

<MudContainer Class="pa-4 mx-auto my-4" >
    <MudTextField T="string" @bind-Value="_workflow.Name" Label="Workflow Name" Variant="Variant.Filled" Class="mb-3" />
    <MudSelect T="string" @bind-Value="_workflow.Trigger.ActivityType" Label="Trigger" Variant="Variant.Filled" Class="mb-4">
        @foreach (var option in _triggerOptions)
        {
            <MudSelectItem T="string" Value="@option">@option</MudSelectItem>
        }
    </MudSelect>
    <MudDivider Class="mb-4" />
    <SimpleWorkflowDiagram Workflow="_workflow" ActivityOptions="_activityOptions" ConditionOptions="_conditionOptions" />
    <MudDivider Class="mb-4" />
    <MudButton OnClick="Generate" Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Code" Class="mb-2">
        Generate
    </MudButton>
</MudContainer>

@code {
    protected WorkflowModel _workflow = new();

    protected string? _json;
    private readonly List<string> _triggerOptions = new() { "PolicyCreated", "PremiumDue", "MortgageApplicationSubmitted" };
    private readonly List<string> _activityOptions = new() { "SendPolicyDocument", "EvaluateMortgageApplication", "WaitForDocuments" };
    private readonly List<string> _conditionOptions = new() { "NoCondition", "PolicyActive", "LoanApproved" };

    void Generate()
    {
        _json = WorkflowService.GenerateJson(_workflow);
    }
}
